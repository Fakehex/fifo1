{% extends 'base.html.twig' %}

{% block title %}Forum{% endblock %}

{% block body %}
<script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous">
</script>
<div class="container">

    <div id="accordion">

    <h5 class="card-header bg-dark text-white text-center">FORUM</h5>
    <div class="container">
      <div class="row listCategorie">
      </div>
    </div>

          {% for donnee in donnees %}
						{% set categorie = donnee[0] %}
						{% set topics = donnee[1] %}

            <div class="card">
            <button type="submit" class="m-1 btn btn-secondary categorie{{loop.index}}" id="heading{{loop.index}}" data-toggle="collapse" data-target="#collapse{{loop.index}}">{{categorie.titre}}</button>
            <div id="collapse{{loop.index}}" class="collapse" aria-labelledby="heading{{loop.index}}" data-parent="#accordion">
							<form method="get" action="{{ path('nouveau_topic', {'slugCategorie': categorie.slug}) }}">
									<button type="submit" class="btn btn-success">Nouveau topic dans {{categorie.titre}}</button>
							</form>
						  <div class="card-body">

                <table id="matable{{loop.index}}" class="table table-striped table-bordered">
									<thead class="thead-dark">
								    <tr>
								      <th scope="col">Topics</th>
											<th scope="col">Publié le</th>
								      <th scope="col">Reponses</th>
								    </tr>
								  </thead>
                {% set recordsFound = 0 %}
								<tbody>
                {% for topic in topics %}
                  {% if topic.categorieForum == categorie %}
                    {% set recordsFound = 1 %}
                    <tr class='clickable-row lignehover{{loop.index}}' data-href='{{ path('topic', {'slugCategorie': categorie.slug , 'slugTopic': topic.slug }) }}'>
                        <td>
                          {{topic.titre}}
                        </td>
												<td>
													{{topic.date | date("m/d/Y", "Europe/Paris")}}
                        </td>
												<td>
													{{topic.nbCommentaires}}
                        </td>

                    </tr>
										<script>
										$(function() {
												$('.lignehover'+{{loop.index}}).hover(function() {
												$('.lignehover'+{{loop.index}}).css('background-color', 'grey');
												$('.lignehover'+{{loop.index}}).css('color', 'black');
											}, function() {
												// on mouseout, reset the background colour
												$('.lignehover'+{{loop.index}}).css('background-color', '');
												$('.lignehover'+{{loop.index}}).css('color', '');
											});
										});
										</script>
                  {% endif %}
                {% endfor %}
								{% if recordsFound == 0 %}
                  <tr>
                    <td>
                      Pas de topics dans cette catégorie ! Soit le premier !
                    </td>
                  </tr>
                {% endif %}
								</tbody>



                </table>
								<div class="pagination-container">
									<nav>
										<ul class="pagination{{loop.index}} pagination">

										</ul>
									</nav>
								</div>
              </div>
            </div>
          </div>
          <script>
            $( ".listCategorie").append( $(".categorie" + {{loop.index}}) );
					</script>
					<script>
					$( document ).ready(function(){
						var table = '#matable{{loop.index}}'
						$('.pagination{{loop.index}}').html('')
						var trnum = 0
						var maxRows = 10
						var totalRows = $(table + ' tbody tr').length;

						$(table + ' tr:gt(0)').each(function(){
							trnum++
							if(trnum > maxRows){
								$(this).hide()
							}
							if(trnum <= maxRows){
								$(this).show()
							}
						})
						if(totalRows > maxRows){
							var pagenum = Math.ceil(totalRows/maxRows)
							for(var i=1; i<=pagenum;i++){
								$('.pagination{{loop.index}}').append('<li class="page-item" data-page="'+i+'">\<a class="page-link" href="#">'+ i + '<span class="sr-only">(current)</span></a>\</li>').show()
							}

						}
						$('.pagination{{loop.index}} li:first-child').addClass('active')
						$('.pagination{{loop.index}} li').click( function(){
							var pageNum = $(this).attr('data-page')
							var trIndex = 0;
							$('.pagination{{loop.index}} li').removeClass('active')
							$(this).addClass('active')
							$(table+' tr:gt(0)').each(function(){
								trIndex++
								if(trIndex > (maxRows*pageNum) || trIndex <= ((maxRows*pageNum)-maxRows)){
									$(this).hide()
								} else{
									$(this).show()
								}
							})
						})
					})
          </script>

          {% else %}
            <tr>
              <td colspan="5">no records found</td>
            </tr>
          {% endfor %}

  </div>
  </div>
<script>
jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
        window.location = $(this).data("href");
    });
});

</script>

{% endblock %}
