{% extends 'base.html.twig' %}

{% block title %}Forum{% endblock %}

{% block body %}
<script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous">
</script>
<div class="container">

    <div id="accordion">

    <h5 class="card-header bg-dark text-white text-center">FORUM</h5>
    <div class="container">
      <div class="row listCategorie">
      </div>
    </div>

          {% for categorie in categories %}
            <div class="card">
            <button type="submit" class="m-1 btn btn-secondary categorie{{loop.index}}" id="heading{{loop.index}}" data-toggle="collapse" data-target="#collapse{{loop.index}}">{{categorie.titre}}</button>
            <div id="collapse{{loop.index}}" class="collapse" aria-labelledby="heading{{loop.index}}" data-parent="#accordion">
							<form method="get" action="{{ path('nouveau_topic', {'slugCategorie': categorie.slug}) }}">
									<button type="submit" class="btn btn-success">Nouveau topic dans {{categorie.titre}}</button>
							</form>
						  <div class="card-body">

                <table class="table table-striped table-bordered">
									<thead class="thead-dark">
								    <tr>
								      <th scope="col">Topics</th>
											<th scope="col">Publié le</th>
								      <th scope="col">Reponses</th>
								    </tr>
								  </thead>
                {% set recordsFound = 0 %}
                {% for topic in topics %}
                  {% if topic.categorieForum == categorie %}
                    {% set recordsFound = 1 %}
                    <tr class='clickable-row lignehover{{loop.index}}' data-href='{{ path('topic', {'slugCategorie': categorie.slug , 'slugTopic': topic.slug }) }}'>
                        <td>
                          {{topic.titre}}
                        </td>
												<td>
													{{topic.date | date("m/d/Y", "Europe/Paris")}}
                        </td>
												<td>
													{{topic.nbCommentaires}}
                        </td>

                    </tr>
										<script>
										$(function() {
												$('.lignehover'+{{loop.index}}).hover(function() {
												$('.lignehover'+{{loop.index}}).css('background-color', 'grey');
												$('.lignehover'+{{loop.index}}).css('color', 'black');
											}, function() {
												// on mouseout, reset the background colour
												$('.lignehover'+{{loop.index}}).css('background-color', '');
												$('.lignehover'+{{loop.index}}).css('color', '');
											});
										});
										</script>
                  {% endif %}
                {% endfor %}

                {% if recordsFound == 0 %}
                  <tr>
                    <td>
                      Pas de topics dans cette catégorie ! Soit le premier !
                    </td>
                  </tr>
                {% endif %}
                </table>
              </div>
            </div>
          </div>
          <script>
            $( ".listCategorie").append( $(".categorie" + {{loop.index}}) );
          </script>
          {% else %}
            <tr>
              <td colspan="5">no records found</td>
            </tr>
          {% endfor %}

  </div>
  </div>
<script>
jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
        window.location = $(this).data("href");
    });
});
</script>

{% endblock %}
